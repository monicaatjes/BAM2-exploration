---
title: "Reputation"
author: "Moniek"
date: "5/7/2020"
output: ingmarkdowntemplates::ing_html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# to run: open data1, test & result of new data BAM
```

## Summary

This dashboard shows reputation scores in line with what The Reputation Institure used to report for ING. Altough the same methodology is applied, it is not possible to reproduce the (pulse) scores exactly because of unknown cultural correction. The aim is to provide insights in ING's reputation. 

<br>

<div class="row">
  <div class="col-md-6" markdown="1">

  **Overview countries**
  
```{r overview pulse , echo=F, eval=T, fig.align='left', fig.width=5.8, fig.height=4, message=F, warning=FALSE}





rep <- test %>%
  dplyr::select(quarter_measurement, country, b_value, pulse, `RepTrakÂ® Pulse`) %>%
  dplyr::filter(quarter_measurement > 16 & b_value==1) %>%
  dplyr::filter(country!=3) %>%
  dplyr::filter(country!=6) %>%
  dplyr::filter(country!=9) %>%
  dplyr::mutate(pulse = case_when(
    country ==14 & quarter_measurement==19 ~ pulse /1.603,
    TRUE ~ pulse
  )) 



c <- c("Australia", "Austria", "Czech", "France", "Italy", "Luxembourg", 
       "Poland", "Romania", "Spain", "Turkey", "The Philippines")
r <- plot_ly(
  type = 'table',
  columnwidth = c(40, 20, 20, 20),
  columnorder = c(0, 1, 2, 3),
  header = list(
     values = c("<b>country<b>","<b>Q3 2019<b>", "<b>Q4 2019<b>", "<b>Q1 2020<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(c, round(rep$pulse[rep$quarter_measurement==19], digits=2),
                   round(rep$pulse[rep$quarter_measurement==20], digits=2), 
                   round(rep$pulse[rep$quarter_measurement==21], digits=2)),
    align = c("left", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
r

```
</div>
  <div class="col-md-6" markdown="1">
  
  **ING vs delta market average**
  
```{r overview ma, echo=F, eval=T, fig.align='left', fig.width=5.8, fig.height=4, message=F, warning=FALSE}

quickfact <- test %>%
  dplyr::select(label, country, labels_countries, quarter_measurement, labels_quarters, pulse, b_value,
                main_competition) %>%
  dplyr::filter(quarter_measurement >=17 & main_competition ==1) %>%
  dplyr::filter(country!=3) %>%
  dplyr::filter(country!=6) %>%
  dplyr::filter(country!=9) %>%
  dplyr::group_by(quarter_measurement, country) %>%
  dplyr::mutate(
    #pulse = round(pulse, digits=2),
    MA_pulse = mean(round(pulse, digits=2)),
    best_pulse = max(round(pulse, digits=2)),
    ING_pulse = case_when(
      b_value ==1 ~ round(pulse, digits=2),
      TRUE ~ NA_real_),
  ) %>%
  dplyr::ungroup()

quickfact <- quickfact %>%
  dplyr::mutate(
    gap = ING_pulse - MA_pulse
  )

xaxis <- list(title = "quarters", 
              titlefont = list(color = 'rgb(105, 105, 105)', size = 12, family = "ING me"),
              #range =c(20,80),
              #dtick = 10,
              showline = TRUE,
              showgrid = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "delta ING - MA",
              titlefont = list(color = 'rgb(105, 105, 105)', size = 12, family = "ING me"),
              range =c(-15,15),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 5,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
gapplot <- quickfact %>%
  plot_ly(x = ~labels_quarters, y = ~gap, type = 'scatter', color ='rgb(255,098,000)',
           mode = 'text+markers', text = ~labels_countries, textposition = 'middle right',
           textfont = list(family = "ING me", color = 'rgb(105, 105, 105)', size = 11)) %>%
  layout(title = '',
         xaxis = xaxis,
         yaxis = yaxis)
gapplot

```
 </div>
</div>


##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/aus.png) Australia

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickAUS_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==1 & quarter_measurement==21 & b_value<6) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$ANZ <- as.numeric(as.character(quickfactt$ANZ))
quickfactt$Commonwealth <- as.numeric(as.character(quickfactt$Commonwealth))
quickfactt$NAB <- as.numeric(as.character(quickfactt$NAB))
quickfactt$Westpac <- as.numeric(as.character(quickfactt$Westpac))

quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>ANZ<b>", "<b>NAB<b>","<b>Commonwealth<b>", "<b>Westpac<b>"),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$ANZ, quickfactt$NAB, 
                   quickfactt$Commonwealth, quickfactt$Westpac),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split AUS, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==1 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickAUS, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==1 & quarter_measurement==21 & b_value<6) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$ANZ <- as.numeric(as.character(quickfactt$ANZ))
quickfactt$Commonwealth <- as.numeric(as.character(quickfactt$Commonwealth))
quickfactt$NAB <- as.numeric(as.character(quickfactt$NAB))
quickfactt$Westpac <- as.numeric(as.character(quickfactt$Westpac))

quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$ANZ, 
            name = 'ANZ', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$Commonwealth, 
            name = 'Commonwealth', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$NAB, 
            name = 'NAB', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$Westpac, 
            name = 'Westpac', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1


```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse AUS, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3, rep_trak4,
                rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==1 & quarter_measurement>16 & b_value<6) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ANZ"], name = 'ANZ', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Commonwealth"], name = 'Commonwealth', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="NAB"], name = 'NAB', type='scatter', 
            line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Westpac"], name = 'Wespac', type='scatter', 
            line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div>  
</div>


### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1AUS, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==1 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split AUS, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==1 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1



```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>


##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/aut.png) Austria

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickAUT_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==2 & quarter_measurement==21 & b_value<7) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$Raiffeisen <- as.numeric(as.character(quickfactt$Raiffeisen))
quickfactt$`Erste Bank` <- as.numeric(as.character(quickfactt$`Erste Bank`))
quickfactt$UniCredit <- as.numeric(as.character(quickfactt$UniCredit))
quickfactt$Volksbankensektor <- as.numeric(as.character(quickfactt$Volksbankensektor))
quickfactt$BAWAG<- as.numeric(as.character(quickfactt$BAWAG))

quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5, 6),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>Raiffeisen<b>", "<b>Erste Bank<b>","<b>UniCredit<b>", "<b>Volksbankensektor<b>", "<b>BAWAG<b>"),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$Raiffeisen, quickfactt$`Erste Bank`, 
                   quickfactt$UniCredit, quickfactt$Volksbankensektor, quickfactt$BAWAG),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split AUT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==2 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickAUT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==2 & quarter_measurement==21 & b_value<7) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$Raiffeisen <- as.numeric(as.character(quickfactt$Raiffeisen))
quickfactt$`Erste Bank` <- as.numeric(as.character(quickfactt$`Erste Bank`))
quickfactt$UniCredit <- as.numeric(as.character(quickfactt$UniCredit))
quickfactt$Volksbankensektor <- as.numeric(as.character(quickfactt$Volksbankensektor))
quickfactt$BAWAG<- as.numeric(as.character(quickfactt$BAWAG))

quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$Raiffeisen, 
            name = 'Raiffeisen', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Erste Bank`, 
            name = 'Erste Bank', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$UniCredit, 
            name = 'Unicredit', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$Volksbankensektor, 
            name = 'Volksbankensektor', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
   add_trace(y = ~quickfactt$BAWAG, 
            name = 'BAWAG', marker = list(color = 'rgb(82,81,153)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1


```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse AUT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3, rep_trak4,
                rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==2 & quarter_measurement>16 & b_value<7) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Raiffeisen"], name = 'Raiffeisen', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Erste Bank"], name = 'Erste Bank', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="UniCredit"], name = 'UniCredit', type='scatter', 
            line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Volksbankensektor"], name = 'Volksbankensektor', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BAWAG"], name = 'BAWAG', type='scatter', 
            line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1AUT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==2 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split AUT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==2 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1



```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/cz.png) Czech Republic

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickCZ_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==4 & quarter_measurement==21 & b_value<6) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`Cesk  spoitelna` <- as.numeric(as.character(quickfactt$`Cesk  spoitelna`))
quickfactt$SOB <- as.numeric(as.character(quickfactt$SOB))
quickfactt$`Komern  banka` <- as.numeric(as.character(quickfactt$`Komern  banka`))
quickfactt$`UniCredit Bank Czech Republic and Slovakia` <- as.numeric(as.character(quickfactt$`UniCredit Bank Czech Republic and Slovakia`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>ACesk spoitelna<b>", "<b>SOB<b>","<b>Komern banka<b>", "<b>UniCredit Bank<b>"),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$`Cesk  spoitelna`, quickfactt$SOB, 
                   quickfactt$`Komern  banka`, quickfactt$`UniCredit Bank Czech Republic and Slovakia`),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split CZ, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==4 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickCZ, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==4 & quarter_measurement==21 & b_value<6) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`Cesk  spoitelna` <- as.numeric(as.character(quickfactt$`Cesk  spoitelna`))
quickfactt$SOB <- as.numeric(as.character(quickfactt$SOB))
quickfactt$`Komern  banka` <- as.numeric(as.character(quickfactt$`Komern  banka`))
quickfactt$`UniCredit Bank Czech Republic and Slovakia` <- as.numeric(as.character(quickfactt$`UniCredit Bank Czech Republic and Slovakia`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Cesk  spoitelna`, 
            name = 'Cesk  spoitelna', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$SOB, 
            name = 'SOB', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Komern  banka`, 
            name = 'Komern  banka', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$`UniCredit Bank Czech Republic and Slovakia`, 
            name = 'UniCredit Bank', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1


```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse CZ, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3, rep_trak4,
                rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==4 & quarter_measurement>16 & b_value<6) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Cesk  spoitelna"], name = 'Cesk  spoitelna', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="SOB"], name = 'SOB', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Komern  banka"], name = 'Komern  banka', type='scatter', 
            line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="UniCredit Bank Czech Republic and Slovakia"], name = 'UniCredit', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1CZ, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==4 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split CZ, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==4 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/fr.png) France

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickFR_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==5 & quarter_measurement==21 & b_value<8) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`BNP Paribas` <- as.numeric(as.character(quickfactt$`BNP Paribas`))
quickfactt$`Caisse d Epargne` <- as.numeric(as.character(quickfactt$`Caisse d Epargne`))
quickfactt$`Cr dit Agricole` <- as.numeric(as.character(quickfactt$`Cr dit Agricole`))
quickfactt$`Cr dit Mutuel` <- as.numeric(as.character(quickfactt$`Cr dit Mutuel`))
quickfactt$`Soci t  G n rale` <- as.numeric(as.character(quickfactt$`Soci t  G n rale`))
quickfactt$Boursorama <- as.numeric(as.character(quickfactt$Boursorama))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5, 6, 7),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>BNP Paribas<b>", "<b>Caisse de Epargne<b>", "<b>Credit Agricole<b>", "<b>Credit Mutuel<b>", "<b>Societe  Generale<b>", "<b>Boursorama<b>"),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$`BNP Paribas`, quickfactt$`Caisse d Epargne`,
                   quickfactt$`Cr dit Agricole`, quickfactt$`Cr dit Mutuel`, quickfactt$`Soci t  G n rale`,
                   quickfactt$`Boursorama`),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split FR, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==5 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickFR, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==5 & quarter_measurement==21 & b_value<8) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`BNP Paribas` <- as.numeric(as.character(quickfactt$`BNP Paribas`))
quickfactt$`Caisse d Epargne` <- as.numeric(as.character(quickfactt$`Caisse d Epargne`))
quickfactt$`Cr dit Agricole` <- as.numeric(as.character(quickfactt$`Cr dit Agricole`))
quickfactt$`Cr dit Mutuel` <- as.numeric(as.character(quickfactt$`Cr dit Mutuel`))
quickfactt$`Soci t  G n rale` <- as.numeric(as.character(quickfactt$`Soci t  G n rale`))
quickfactt$Boursorama <- as.numeric(as.character(quickfactt$Boursorama))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$`BNP Paribas`, 
            name = 'BNP Paribas', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Caisse d Epargne`, 
            name = 'Caisse de Epargne', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Cr dit Agricole`, 
            name = 'Credit Agricole', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Cr dit Mutuel`, 
            name = 'Credit Mutuel', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
   add_trace(y = ~quickfactt$`Soci t  G n rale`, 
            name = 'Societe Generale', marker = list(color = 'rgb(82,81,153)', width = 4)) %>%
   add_trace(y = ~quickfactt$Boursorama, 
            name = 'Boursorama', marker = list(color = 'rgb(168,168,168)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse FR, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3, rep_trak4,
                rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==5 & quarter_measurement>16 & b_value<8) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BNP Paribas"], name = 'BNP Paribas', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Caisse d Epargne"], name = 'Caisse de Epargne', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Cr dit Agricole"], name = 'Credit Agricole', type='scatter', 
            line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Cr dit Mutuel"], name = 'Credit Mutuel', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Soci t  G n rale"], name = 'Societe Generale', type='scatter', line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Boursorama"], name = 'Boursorama', type='scatter', line = list(color = 'rgb(168,168,168)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1FR, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==5 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split FR, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==5 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/it.png) Italy

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickIT_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==7 & quarter_measurement==21 & b_value<12 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BancoPosta <- as.numeric(as.character(quickfactt$BancoPosta))
quickfactt$BNL <- as.numeric(as.character(quickfactt$BNL))
quickfactt$`Intesa Sanpaolo` <- as.numeric(as.character(quickfactt$`Intesa Sanpaolo`))
quickfactt$`Monte dei P diS` <- as.numeric(as.character(quickfactt$`Monte dei P diS`))
quickfactt$Unicredit <- as.numeric(as.character(quickfactt$Unicredit))
quickfactt$Chebanca <- as.numeric(as.character(quickfactt$Chebanca))
quickfactt$Fineco <- as.numeric(as.character(quickfactt$Fineco))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5, 6, 7, 8),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>BancoPosta<b>", "<b>BNL<b>", "<b>Intesa Sanpaolo<b>", "<b>Monte dei Paschi<b>", "<b>UniCredit<b>", "<b>Chebanca<b>", "<b>Fineco<b>"),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$BancoPosta, quickfactt$BNL,
                   quickfactt$`Intesa Sanpaolo`, quickfactt$`Monte dei P diS`, quickfactt$Unicredit,
                   quickfactt$Chebanca, quickfactt$Fineco),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split IT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==7 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickIT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==7 & quarter_measurement==21 & b_value<12 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BancoPosta <- as.numeric(as.character(quickfactt$BancoPosta))
quickfactt$BNL <- as.numeric(as.character(quickfactt$BNL))
quickfactt$`Intesa Sanpaolo` <- as.numeric(as.character(quickfactt$`Intesa Sanpaolo`))
quickfactt$`Monte dei P diS` <- as.numeric(as.character(quickfactt$`Monte dei P diS`))
quickfactt$Unicredit <- as.numeric(as.character(quickfactt$Unicredit))
quickfactt$Chebanca <- as.numeric(as.character(quickfactt$Chebanca))
quickfactt$Fineco <- as.numeric(as.character(quickfactt$Fineco))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$BancoPosta, 
            name = 'Banco Posta', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$BNL, 
            name = 'BNL', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Intesa Sanpaolo`, 
            name = 'Intesa Sanpaolo', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Monte dei P diS`, 
            name = 'Monte dei Pashi di Sienna', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
   add_trace(y = ~quickfactt$Unicredit, 
            name = 'Unicredit', marker = list(color = 'rgb(82,81,153)', width = 4)) %>%
   add_trace(y = ~quickfactt$Chebanca, 
            name = 'Chebanca', marker = list(color = 'rgb(168,168,168)', width = 4)) %>%
  add_trace(y = ~quickfactt$Fineco, 
            name = 'Fineco', marker = list(color = 'rgb(105,105,105)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse IT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3, rep_trak4,
                rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==7 & quarter_measurement>16 & b_value<12) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BancoPosta"], name = 'Banco Posta', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BNL"], name = 'BNL', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Intesa Sanpaolo"], name = 'Intesa Sanpaolo', type='scatter', 
            line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Monte dei P diS"], name = 'Monte dei Pashi di Sienna', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Unicredit"], name = 'Unicredit', type='scatter', line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Chebanca"], name = 'Chebanca', type='scatter', line = list(color = 'rgb(168,168,168)', type='scatter', width = 4, mode = 'lines+markers')) %>%
   add_lines(y = ~quickfact$pulse[quickfact$label=="Fineco"], name = 'Fineco', type='scatter', line = list(color = 'rgb(105,105,105)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1IT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==7 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split IT, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==7 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/lu.png) Luxembourg

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickLU_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==8 & quarter_measurement==21 & b_value<6 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`Banque et Caisse` <- as.numeric(as.character(quickfactt$`Banque et Caisse`))
quickfactt$`BGL BNP Paribas` <- as.numeric(as.character(quickfactt$`BGL BNP Paribas`))
quickfactt$`Banque International` <- as.numeric(as.character(quickfactt$`Banque International`))
quickfactt$Raiffeisen <- as.numeric(as.character(quickfactt$Raiffeisen))

quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>Banque et Caisse<b>", "<b>BGL BNP Paribas<b>", "<b>Banque International<b>", "<b>Raiffeisen<b>"),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$`Banque et Caisse`, quickfactt$`BGL BNP Paribas`, quickfactt$`Banque International`, quickfactt$Raiffeisen),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split LU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==8 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickLU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==8 & quarter_measurement==21 & b_value<6 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`Banque et Caisse` <- as.numeric(as.character(quickfactt$`Banque et Caisse`))
quickfactt$`BGL BNP Paribas` <- as.numeric(as.character(quickfactt$`BGL BNP Paribas`))
quickfactt$`Banque International` <- as.numeric(as.character(quickfactt$`Banque International`))
quickfactt$Raiffeisen <- as.numeric(as.character(quickfactt$Raiffeisen))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Banque et Caisse`, 
            name = 'Banque et Caisse', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$`BGL BNP Paribas`, 
            name = 'BGL BNP Paribas', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Banque International`, 
            name = 'Banque International', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$Raiffeisen, 
            name = 'Raiffeisen', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse LU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==8 & quarter_measurement>16 & b_value<6) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Banque et Caisse"], name = 'Banque et Caisse', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BGL BNP Paribas"], name = 'BGL BNP Paribas', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Banque International"], name = 'Banque International', type='scatter', line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
    add_lines(y = ~quickfact$pulse[quickfact$label=="Raiffeisen"], name = 'Raiffeisen', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1LU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==8 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split LU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==8 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/po.png) Poland

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickPO_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==10 & quarter_measurement==21 & b_value<8 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`Bank Zachodni` <- as.numeric(as.character(quickfactt$`Bank Zachodni`))
quickfactt$mBank <- as.numeric(as.character(quickfactt$mBank))
quickfactt$`Pekao S A` <- as.numeric(as.character(quickfactt$`Pekao S A`))
quickfactt$`PKO BP` <- as.numeric(as.character(quickfactt$`PKO BP`))
quickfactt$`Getin Bank` <- as.numeric(as.character(quickfactt$`Getin Bank`))

quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5, 6),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>Bank Zachodni<b>", "<b>mBank <b>", "<b>Pekao S A<b>", "<b>PKO BP<b>", "<b>Getin Bank<b>"),
    align = c("left", "right", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$`Bank Zachodni`, quickfactt$mBank, quickfactt$`Pekao S A`, quickfactt$`PKO BP`, quickfactt$`Getin Bank`),
    align = c("left", "right", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split Po, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==10 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickPO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==10 & quarter_measurement==21 & b_value<7 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$`Bank Zachodni` <- as.numeric(as.character(quickfactt$`Bank Zachodni`))
quickfactt$mBank <- as.numeric(as.character(quickfactt$mBank))
quickfactt$`Pekao S A` <- as.numeric(as.character(quickfactt$`Pekao S A`))
quickfactt$`PKO BP` <- as.numeric(as.character(quickfactt$`PKO BP`))
quickfactt$`Getin Bank` <- as.numeric(as.character(quickfactt$`Getin Bank`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Bank Zachodni`, 
            name = 'Bank Zachodni', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$mBank, 
            name = 'mBank', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Pekao S A`, 
            name = 'Pekao S A', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$`PKO BP`, 
            name = 'PKO BP', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
   add_trace(y = ~quickfactt$`Getin Bank`, 
            name = 'Getin Bank', marker = list(color = 'rgb(82,81,153)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse PO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==10 & quarter_measurement>16 & b_value<7) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Bank Zachodni"], name = 'Bank Zachodni', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="mBank"], name = 'mBank', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Pekao S A"], name = 'Pekao S A', type='scatter', line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
    add_lines(y = ~quickfact$pulse[quickfact$label=="PKO BP"], name = 'PKO BP', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Getin Bank"], name = 'Getin Bank', type='scatter', line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1PO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==10 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split PO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==10 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/ro.png) Romania

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickRO_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==11 & quarter_measurement==21 & b_value<8 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BCR<- as.numeric(as.character(quickfactt$BCR))
quickfactt$BRD <- as.numeric(as.character(quickfactt$BRD))
quickfactt$Raiffeisen <- as.numeric(as.character(quickfactt$Raiffeisen))
quickfactt$`Banca Transilvania` <- as.numeric(as.character(quickfactt$`Banca Transilvania`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>BCR<b>", "<b>BRD<b>", "<b>Raiffeisen<b>", "<b>Banca Transilvania<b>"),
    align = c("left", "right", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$BCR, quickfactt$BRD, quickfactt$Raiffeisen, quickfactt$`Banca Transilvania`),
    align = c("left", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split ro, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==11 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickRO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==11 & quarter_measurement==21 & b_value<7 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BCR<- as.numeric(as.character(quickfactt$BCR))
quickfactt$BRD <- as.numeric(as.character(quickfactt$BRD))
quickfactt$Raiffeisen <- as.numeric(as.character(quickfactt$Raiffeisen))
quickfactt$`Banca Transilvania` <- as.numeric(as.character(quickfactt$`Banca Transilvania`))



quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$BCR, 
            name = 'BCR', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$BRD, 
            name = 'BRD', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$Raiffeisen, 
            name = 'Raiffeisen', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Banca Transilvania`, 
            name = 'Banca Transilvania', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse RO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==11 & quarter_measurement>16 & b_value<7) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BCR"], name = 'BCR', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BRD"], name = 'BRD', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Raiffeisen"], name = '	Raiffeisen', type='scatter', line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
    add_lines(y = ~quickfact$pulse[quickfact$label=="Banca Transilvania"], name = 'Banca Transilvania', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```

 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1RO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==11 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split RO, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==11 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/sp.png) Spain

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickSP_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==12 & quarter_measurement==21 & b_value<8 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BBVA<- as.numeric(as.character(quickfactt$BBVA))
quickfactt$`Banco Santander` <- as.numeric(as.character(quickfactt$`Banco Santander`))
quickfactt$`Banco Sabadell` <- as.numeric(as.character(quickfactt$`Banco Sabadell`))
quickfactt$Bankia <- as.numeric(as.character(quickfactt$Bankia))
quickfactt$`La Caixa` <- as.numeric(as.character(quickfactt$`La Caixa`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5, 6),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>BBVA<b>", "<b>Banco Santander<b>", "<b>Banco Sabadell<b>", "<b>Bankia<b>", "<b>La Caixa<b>"),
    align = c("left", "right", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$BBVA, quickfactt$`Banco Santander`, quickfactt$`Banco Sabadell`, quickfactt$Bankia, quickfactt$`La Caixa`),
    align = c("left", "right", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split sp, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==12 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickSp, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==12 & quarter_measurement==21 & b_value<7 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BBVA<- as.numeric(as.character(quickfactt$BBVA))
quickfactt$`Banco Santander` <- as.numeric(as.character(quickfactt$`Banco Santander`))
quickfactt$`Banco Sabadell` <- as.numeric(as.character(quickfactt$`Banco Sabadell`))
quickfactt$Bankia <- as.numeric(as.character(quickfactt$Bankia))
quickfactt$`La Caixa` <- as.numeric(as.character(quickfactt$`La Caixa`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$BBVA, 
            name = 'BBVA', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Banco Santander`, 
            name = 'Banco Santander', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Banco Sabadell`, 
            name = 'Banco Sabadell', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$Bankia, 
            name = 'Bankia', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
  add_trace(y = ~quickfactt$`La Caixa`, 
            name = 'La Caixa', marker = list(color = 'rgb(82,81,153)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse SP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==12 & quarter_measurement>16 & b_value<7) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BBVA"], name = 'BBVA', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Banco Santander"], name = 'Banco Santander', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Banco Sabadell"], name = 'Banco Sabadell', type='scatter', line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
    add_lines(y = ~quickfact$pulse[quickfact$label=="Bankia"], name = 'Bankia', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
      add_lines(y = ~quickfact$pulse[quickfact$label=="La Caixa"], name = 'La Caixa', type='scatter', line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```



 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1SP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==12 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split SP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==12 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/tu.png) Turkey

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickTU_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==13 & quarter_measurement==21 & b_value<8 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$Akbank<- as.numeric(as.character(quickfactt$Akbank))
quickfactt$Garanti <- as.numeric(as.character(quickfactt$Garanti))
quickfactt$ISBankas <- as.numeric(as.character(quickfactt$ISBankas))
quickfactt$Yap <- as.numeric(as.character(quickfactt$Yap))
quickfactt$`Ziraat Bankas` <- as.numeric(as.character(quickfactt$`Ziraat Bankas`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5, 6),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>Akbank<b>", "<b>Garanti<b>", "<b>IsBankasi<b>", "<b>Yapi<b>", "<b>Ziraat<b>"),
    align = c("left", "right", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$Akbank, quickfactt$Garanti, quickfactt$ISBankas, quickfactt$Yap, quickfactt$`Ziraat Bankas`),
    align = c("left", "right", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split TU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==13 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickTU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==13 & quarter_measurement==21 & b_value<7 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$Akbank<- as.numeric(as.character(quickfactt$Akbank))
quickfactt$Garanti <- as.numeric(as.character(quickfactt$Garanti))
quickfactt$ISBankas <- as.numeric(as.character(quickfactt$ISBankas))
quickfactt$Yap <- as.numeric(as.character(quickfactt$Yap))
quickfactt$`Ziraat Bankas` <- as.numeric(as.character(quickfactt$`Ziraat Bankas`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$Akbank, 
            name = 'Akbank', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$Garanti, 
            name = 'Garanti', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$ISBankas, 
            name = 'IsBankasi', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$Yap, 
            name = 'Yapi', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
  add_trace(y = ~quickfactt$`Ziraat Bankas`, 
            name = 'Ziraat Bankasi', marker = list(color = 'rgb(82,81,153)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse TU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==13 & quarter_measurement>16 & b_value<7) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Akbank"], name = 'Akbank', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Garanti"], name = 'Garanti', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ISBankas"], name = 'IsBankasi', type='scatter', line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
    add_lines(y = ~quickfact$pulse[quickfact$label=="Yap"], name = 'Yapi', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
      add_lines(y = ~quickfact$pulse[quickfact$label=="Ziraat Bankas"], name = 'Ziraat', type='scatter', line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```



 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1TU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==13 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split TU, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==13 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>

##  ![](/Users/xo21bm/Documents/Lokaal/BAM2/exploration/notebooks/ph.png) The Philippines

### **Quick facts**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickPH_COMP, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=3.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==14 & quarter_measurement==21 & b_value<8 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BDO<- as.numeric(as.character(quickfactt$BDO))
quickfactt$Metrobank <- as.numeric(as.character(quickfactt$Metrobank))
quickfactt$BPI <- as.numeric(as.character(quickfactt$BPI))
quickfactt$Unionbank <- as.numeric(as.character(quickfactt$Unionbank))
quickfactt$Maybank <- as.numeric(as.character(quickfactt$Maybank))
quickfactt$`Security Bank` <- as.numeric(as.character(quickfactt$`Security Bank`))

quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45, 45, 45, 45, 45),
  columnorder = c(0, 1, 2, 3, 4, 5, 6, 7),
  header = list(
    values = c("<b>Drivers<b>", "<b>ING<b>", "<b>BDO<b>", "<b>Metrobank<b>", "<b>BPI<b>", "<b>Unionbank<b>", "<b>Maybank<b>", "<b>Security Bank<b>"),
    align = c("left", "right", "right", "right", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)",
                          "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
 ),
  cells = list(
    values = rbind(quickfactt$Drivers, quickfactt$ING, quickfactt$BDO, quickfactt$Metrobank, quickfactt$BPI, quickfactt$Unionbank, quickfactt$Maybank, quickfactt$`Security Bank`),
    align = c("left", "right", "right", "right", "right", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```
 </div>
  <div class="col-md-6" markdown="1">

   **Drivers splitted clients - non clients**
 
```{r driver split PH, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=3, fig.align='left'}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==14 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]

p <- plot_ly(
  type = 'table',
  columnwidth = c(50, 45, 45, 45),
  columnorder = c(0, 1, 2, 3),
  header = list(
    values = c("<b>Drivers<b>", "<b>general pop<b>", "<b>clients<b>", "<b>non clients<b>"),
    align = c("left", "right", "right", "right", "right"),
    line = list(width = 1, color = c("rgb 168, 168, 168")),
    fill = list(color = c("rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)", "rgb(255,098,000)")),
    font = list(family = "ING me", size = 12, color = "white")
  ),
  cells = list(
    values = rbind(split$drivers, split$general_pop, split$clients, split$non_clients),
   align = c("left", "right", "right", "right"),
    line = list(color = c("rgb 168, 168, 168"), width = 1),
    font = list(family = "ING me", size = 12, color = c("rgb 105, 105, 105"))
  ))
p
```

 </div> <div class="row">  
</div>

### **ING vs competition**
  
<div class="row">
  <div class="col-md-6" markdown="1">
  
  
   **Drivers ING vs competition**
   
```{r quickPH, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4.0}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11,
                b_value) %>%
  dplyr::filter(country==14 & quarter_measurement==21 & b_value<7 & !is.na(pulse)) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    products  = round(rep_trak5, digits=2),
    innovation = round(rep_trak6, digits=2),
    workplace = round(rep_trak7, digits=2),
    governance = round(rep_trak8, digits=2),
    citizenship = round(rep_trak9, digits=2),
    leadership = round(rep_trak10, digits=2),
    performance = round(rep_trak11, digits=2),
  )

quickfact <- quickfact[,-c(6:16)]

# transform quickfact to create the plot
quickfactt <- as.data.frame(t(quickfact))
row.names(quickfactt) <- NULL
colnames(quickfactt) = as.character(unlist(quickfactt[1,]))
quickfactt <- quickfactt[-c(1:6),]

quickfactt$ING <- as.numeric(as.character(quickfactt$ING))
quickfactt$BDO<- as.numeric(as.character(quickfactt$BDO))
quickfactt$Metrobank <- as.numeric(as.character(quickfactt$Metrobank))
quickfactt$BPI <- as.numeric(as.character(quickfactt$BPI))
quickfactt$Unionbank <- as.numeric(as.character(quickfactt$Unionbank))
quickfactt$Maybank <- as.numeric(as.character(quickfactt$Maybank))
#quickfactt$`Security Bank` <- as.numeric(as.character(quickfactt$`Security Bank`))


quickfactt$Drivers <- c("Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")

xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                             color = 'rgb(105, 105, 105)'))


p1 <- plot_ly(x = quickfactt$Drivers, y=~quickfactt$ING, 
               name ='ING', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~quickfactt$BDO, 
            name = 'BDO', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~quickfactt$Metrobank, 
            name = 'Metrobank', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  add_trace(y = ~quickfactt$BPI, 
            name = 'BPI', marker = list(color = 'rgb(208,217,60)', width = 4)) %>%
  add_trace(y = ~quickfactt$Unionbank, 
            name = 'Unionbank', marker = list(color = 'rgb(52,150,81)', width = 4)) %>%
  add_trace(y = ~quickfactt$Maybank, 
            name = 'Maybank', marker = list(color = 'rgb(82,81,153)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1

```
 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r pulse PH, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}
quickfact <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, rep_trak1, rep_trak2, rep_trak3,
                rep_trak4, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, b_value) %>%
  dplyr::filter(country==14 & quarter_measurement>16 & b_value<8) %>%
  dplyr::mutate(pulse = case_when(
    pulse = quarter_measurement==19 ~ round(pulse, digits=2) /1.603,
    TRUE ~ round(pulse, digits=2))) %>%
  dplyr::mutate(products = case_when(
    quarter_measurement==19 ~ round(rep_trak5, digits=2) /1.603,
    TRUE ~ round(rep_trak5, digits=2))) %>%
  dplyr::mutate(innovation = case_when(
    quarter_measurement==19 ~ round(rep_trak6, digits=2) /1.603,
    TRUE ~ round(rep_trak6, digits=2))) %>%
  dplyr::mutate(workplace = case_when(
    quarter_measurement==19 ~ round(rep_trak7, digits=2) /1.603,
    TRUE ~ round(rep_trak7, digits=2))) %>%
  dplyr::mutate(governance = case_when(
    quarter_measurement==19 ~ round(rep_trak8, digits=2) /1.603,
    TRUE ~ round(rep_trak8, digits=2))) %>%
  dplyr::mutate(citizenship= case_when(
    quarter_measurement==19 ~ round(rep_trak9, digits=2) /1.603,
    TRUE ~ round(rep_trak9, digits=2))) %>%
  dplyr::mutate(leadership = case_when(
    quarter_measurement==19 ~ round(rep_trak10, digits=2) /1.603,
    TRUE ~ round(rep_trak10, digits=2))) %>%
  dplyr::mutate(performance= case_when(
    quarter_measurement==19 ~ round(rep_trak11, digits=2) /1.603,
    TRUE ~ round(rep_trak11, digits=2)
  ))
      
xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = FALSE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = unique(quickfact$labels_quarters)) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="ING"], name = 'ING', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BDO"], name = 'BDO', type='scatter',
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="Metrobank"], name = 'Metrobank', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~quickfact$pulse[quickfact$label=="BPI"], name = 'BPI', type='scatter', line = list(color = 'rgb(208,217,60)', type='scatter', width = 4, mode = 'lines+markers')) %>%
    add_lines(y = ~quickfact$pulse[quickfact$label=="Unionbank"], name = 'Unionbank', type='scatter', line = list(color = 'rgb(52,150,81)', type='scatter', width = 4, mode = 'lines+markers')) %>%
      add_lines(y = ~quickfact$pulse[quickfact$label=="Maybank"], name = 'Maybank', type='scatter', line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
   add_lines(y = ~quickfact$pulse[quickfact$label=="Security Bank"], name = 'Security Bank', type='scatter', line = list(color = 'rgb(82,81,153)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1

```



 </div> <div class="row">  
</div>

### **Clients and non clients**

<div class="row">
  <div class="col-md-6" markdown="1">

   **Drivers **
```{r split1PH, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.align='left', fig.height=4}
split <- data1 %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, rep_trak1, rep_trak2, rep_trak3, rep_trak4, pulse, 
  rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11, reptrak1_client, reptrak2_client,
  reptrak3_client, reptrak4_client, pulse_clients, reptrak5_client, reptrak6_client, reptrak7_client, reptrak8_client, 
  reptrak9_client, reptrak10_client, reptrak11_client, reptrak1_non_client, reptrak2_non_client, reptrak3_non_client,
  reptrak4_non_client, pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
  reptrak9_non_client, reptrak10_non_client, reptrak11_non_client, b_value) %>%
  dplyr::filter(country==14 & quarter_measurement==21 & b_value==1) %>%
  dplyr::mutate(
    pulse = round(pulse, digits=2),
    rep_trak1 = round(rep_trak1, digits=2),
    rep_trak2 = round(rep_trak2, digits=2),
    rep_trak3 = round(rep_trak3, digits=2),
    rep_trak4 = round(rep_trak4, digits=2),
    rep_trak5 = round(rep_trak5, digits=2),
    rep_trak6 = round(rep_trak6, digits=2),
    rep_trak7 = round(rep_trak7, digits=2),
    rep_trak8 = round(rep_trak8, digits=2),
    rep_trak9 = round(rep_trak9, digits=2),
    rep_trak10 = round(rep_trak10, digits=2),
    rep_trak11 = round(rep_trak11, digits=2),
    pulse_clients = round(pulse_clients, digits=2),
    reptrak1_client = round(reptrak1_client, digits=2),
    reptrak2_client = round(reptrak2_client, digits=2),
    reptrak3_client = round(reptrak3_client, digits=2),
    reptrak4_client = round(reptrak4_client, digits=2),
    reptrak5_client = round(reptrak5_client, digits=2),
    reptrak6_client = round(reptrak6_client, digits=2),
    reptrak7_client = round(reptrak7_client, digits=2),
    reptrak8_client = round(reptrak8_client, digits=2),
    reptrak9_client = round(reptrak9_client, digits=2),
    reptrak10_client = round(reptrak10_client, digits=2),
    reptrak11_client = round(reptrak11_client, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
    reptrak1_non_client = round(reptrak1_non_client, digits=2),
    reptrak2_non_client = round(reptrak2_non_client, digits=2),
    reptrak3_non_client = round(reptrak3_non_client, digits=2),
    reptrak4_non_client = round(reptrak4_non_client, digits=2),
    reptrak5_non_client = round(reptrak5_non_client, digits=2),
    reptrak6_non_client = round(reptrak6_non_client, digits=2),
    reptrak7_non_client = round(reptrak7_non_client, digits=2),
    reptrak8_non_client = round(reptrak8_non_client, digits=2),
    reptrak9_non_client = round(reptrak9_non_client, digits=2),
    reptrak10_non_client = round(reptrak10_non_client, digits=2),
    reptrak11_non_client = round(reptrak11_non_client, digits=2)
  )

splitINGdrivers <- split %>%
  dplyr::select(pulse, rep_trak5, rep_trak6, rep_trak7, rep_trak8, rep_trak9, rep_trak10, rep_trak11) 

splitINGdrivers <- as.data.frame(t(splitINGdrivers))
row.names(splitINGdrivers) <- NULL
splitINGdrivers$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers$general_pop <- as.numeric(as.character(splitINGdrivers$V1))

splitINGdrivers2 <- split %>%
  dplyr::select(pulse_clients, reptrak5_client,reptrak6_client, reptrak7_client, reptrak8_client, reptrak9_client,
                reptrak10_client, reptrak11_client) 

splitINGdrivers2 <- as.data.frame(t(splitINGdrivers2))
row.names(splitINGdrivers2) <- NULL
splitINGdrivers2$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers2$clients <- as.numeric(as.character(splitINGdrivers2$V1))

splitINGdrivers3 <- split %>%
  dplyr::select(pulse_non_clients, reptrak5_non_client, reptrak6_non_client, reptrak7_non_client, reptrak8_non_client,
                reptrak9_non_client, reptrak10_non_client, reptrak11_non_client) 

splitINGdrivers3 <- as.data.frame(t(splitINGdrivers3))
row.names(splitINGdrivers3) <- NULL
splitINGdrivers3$drivers <-c("Pulse", "Products", "Innovation", "Workplace", "Governance", "Citizenship", "Leadership", "Performance")
splitINGdrivers3$non_clients <- as.numeric(as.character(splitINGdrivers3$V1))

split <- cbind(splitINGdrivers, splitINGdrivers2, splitINGdrivers3)
split$V1 <- NULL
split$V1 <- NULL
split$V1 <- NULL
split$drivers <- NULL
split$drivers <- NULL

split <- split %>%
  dplyr::select(drivers, general_pop, clients, non_clients)

split <- split[-1,]


xaxis <- list(title = "",
              showline = TRUE,
              showgrid = FALSE,
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 2,
              #ticklen = 5,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))
yaxis <- list(title = "",
              titlefont = list(family = "ING me",
                               size = 12,
                               color = 'rgb(105, 105, 105)'),
              showline = TRUE,
              showgrid = FALSE,
              range =c(0,100),
              showticklabels = TRUE,
              linecolor = 'rgb(204, 204, 204)',
              linewidth = 2,
              autotick = TRUE,
              #dtick = 50.000,
              ticks = 'inside',
              tickcolor = 'rgb(204, 204, 204)',
              tickwidth = 1,
              #ticklen = 1,
              tickfont = list(family = "ING me",
                              size = 12,
                              color = 'rgb(105, 105, 105)'))

p1 <- plot_ly(x = split$drivers, y=~split$clients, 
               name ='clients', type='bar', marker = list(color = 'rgb(255,098,000)', width = 4)) %>%
  add_trace(y = ~split$general_pop, 
            name = 'general pop', marker = list(color = 'rgb(96,166,218)', width = 4)) %>%
  add_trace(y = ~split$non_clients, 
            name = 'non clients', marker = list(color = 'rgb(171,0,102)', width = 4)) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))
p1
```

 </div>
  <div class="col-md-6" markdown="1">

   **Pulse over time**
 
```{r split PH, echo=FALSE, echo=F, eval=T, fig.width=5.8, fig.height=4, fig.align='left'}

split <- test %>%
  dplyr::select(label, country, quarter_measurement, labels_quarters, pulse, 
  pulse_clients, pulse_non_clients, b_value) %>%
  dplyr::filter(country==14 & quarter_measurement>16 & b_value==1) %>%
  dplyr::mutate(pulse = case_when(
    pulse = quarter_measurement==19 ~ round(pulse, digits=2) /1.603,
    TRUE ~ round(pulse, digits=2))) %>%
  dplyr::mutate(
    pulse_clients = round(pulse_clients, digits=2),
    pulse_non_clients = round(pulse_non_clients, digits=2),
  )

p1 <- plot_ly(x = ~split$labels_quarters) %>%
  add_lines(y = ~split$pulse, name = 'population', type='scatter', 
            line = list(color = 'rgb(255,098,000)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_clients, name = 'clients', type='scatter', 
            line = list(color = 'rgb(96,166,218)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  add_lines(y = ~split$pulse_non_clients, name = 'non clients', type='scatter', 
            line = list(color = 'rgb(171,0,102)', type='scatter', width = 4, mode = 'lines+markers')) %>%
  layout(xaxis = xaxis,
         yaxis = yaxis,
         barmode = 'group', title= "",
         legend =list(font = list(family = "ING me", size = 12, color = 'rgb(105, 105, 105)')))

p1
```
 </div> <div class="row">  
</div>


 </div> <div class="row">
</div></div></div>